# 옽싹 — 내가 할 일 정리

> 코드(Phase 1~8)는 이미 구현된 상태입니다. 아래는 **직접 해야 할 설정·배포·운영** 목록입니다.

---

## 1. 필수: 환경 설정

### 1-1. Supabase
- [x] https://supabase.com 가입 후 **New Project** 생성
- [x] Region: **Northeast Asia (Seoul)** 선택
- [x] **Enable automatic RLS** 체크 (프로젝트 생성 시 또는 Settings > Database에서 새 테이블에 RLS 자동 적용)
- [x] Settings > API에서 **Project URL**, **anon public key** 복사

### 1-2. YouTube API 키
- [x] https://console.cloud.google.com 에서 프로젝트 생성
- [x] **YouTube Data API v3** 사용 설정
- [x] **API 키** 생성 후 복사

### 1-3. TMDB API 키 (선택, 작품 메타데이터용)
- [x] https://www.themoviedb.org 가입
- [x] Settings > API에서 **API Key (v3 auth)** 발급 후 복사

### 1-4. `.env.local` 작성 ✅
- [x] 프로젝트 루트에 `.env.local` 파일이 있는지 확인
- [x] 아래 값 **본인 키로 채우기**:

```env
NEXT_PUBLIC_SUPABASE_URL=https://xxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGci...

YOUTUBE_API_KEY=AIzaSy...

TMDB_API_KEY=abc123...

CRON_SECRET=아무랜덤문자열-보안용
```

---

## 2. 필수: 데이터베이스 초기화 ✅

- [x] Supabase 대시보드 → **SQL Editor** → New query
- [x] `001_initial.sql` 파일 내용 **전체 복사** 후 붙여넣기
- [x] **Run** 클릭
- [x] Table Editor에서 **works**, **videos**, **pending_videos** 테이블 보이면 완료

---

## 3. 로컬에서 실행 확인 ✅

```bash
cd /Users/gimmingyu/Desktop/2025/ottsak
npm run dev
```

- [x] 브라우저에서 http://localhost:3000 접속
- [x] 홈 / 작품 / 영상 / 일정 페이지가 에러 없이 뜨는지 확인  
  (데이터가 없으면 빈 목록으로 보이는 것이 정상)

---

## 4. (선택) 테스트 데이터 넣기

- [ ] Supabase **Table Editor** → **works** → Insert row
- [ ] 예시: slug `moving`, title `무빙`, title_en `Moving`, type `series`, genre `{"액션","드라마"}`, platform `{"Disney+"}`, release_date, rating 등 입력 후 저장
- [ ] 로컬에서 홈/작품 목록에 해당 작품이 보이는지 확인

---

## 5. (선택) Cron(영상 수집) 테스트

- [ ] 로컬에서 `npm run dev` 실행 중일 때  
  브라우저 또는 Postman으로:
  - URL: `http://localhost:3000/api/cron/sync-videos`
  - Header: `Authorization: Bearer (CRON_SECRET에 넣은 값)`
- [ ] 응답에 `synced`, `pending` 등이 오는지 확인
- [ ] Supabase **videos** 테이블에 행이 생겼는지 확인

---

## 6. Vercel 배포 ✅

- [x] https://vercel.com 로그인 (GitHub 연동)
- [x] **New Project** → GitHub 저장소 **mandubird/ottsak** 선택
- [x] **Environment Variables**에 `.env.local` 내용 그대로 입력  
  (NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY, YOUTUBE_API_KEY, CRON_SECRET 등)
- [x] Deploy 실행
- [x] 배포 후 URL 접속해서 동작 확인
- [x] 도메인 연결 (otsak.com 등)

---

## 7. (선택) 추가로 하고 싶은 것

| 할 일 | 비고 |
|--------|------|
| **로고 이미지** 넣기 | `public/`에 로고 파일 넣고 헤더에 `<Image>`로 사용 |
| **NEXT_PUBLIC_SITE_URL** | Vercel 환경 변수에 배포 URL 넣기 → sitemap/robots에 반영 (예: `https://otsak.com`) |
| **TMDB로 작품 자동 수집** | TMDB API로 works 자동 등록 스크립트 추가 |
| **수익 모델 (제휴·굿즈)** | `docs/수익-모델.md` 참고. 작품 상세에 [관련 아이템] 섹션 있음 → 작품별 굿즈/OST/원작 링크 연동 시 수익화 |
| **관련 아이템 반자동 도구** | (나중에) OST/쿠팡 검색으로 후보 링크 자동 수집 → 관리자가 선택해 저장. 품질은 수동, 입력 부담만 줄이는 용도. |

---

## 체크 요약

| 단계 | 내용 | 완료 |
|------|------|------|
| 1 | Supabase / YouTube / TMDB 키 발급, `.env.local` 작성 | ☑ |
| 2 | Supabase에 `001_initial.sql` 실행 | ☑ |
| 3 | `npm run dev` 로 로컬 실행·화면 확인 | ☑ |
| 4 | (선택) works 테스트 데이터 1건 이상 입력 / sync-works로 자동 수집 | ☑ |
| 5 | (선택) Cron API 호출로 영상 수집 테스트 | ☐ |
| 6 | Vercel 배포 + 환경 변수 + 도메인 | ☑ |

---

## 🚀 앞으로 할 일

설정·배포는 끝났어요. 이제 **콘텐츠 채우기**와 **선택 기능**만 하면 됩니다.

| 우선순위 | 할 일 | 설명 |
|----------|--------|------|
| **1** | **작품(works) 데이터 넣기** | **자동:** 아래 "작품 자동 수집" 호출. **수동:** Supabase Table Editor → works → Insert row. |
| **2** | **불러온 작품에 유튜브 영상 가져오기** | **지금 한 번:** `GET https://본인도메인.com/api/cron/sync-videos` + Header `X-Cron-Secret: (CRON_SECRET 값)` 호출 → works(최근 30일) 기준으로 예고편/쇼츠/리뷰 수집. 이후는 Vercel Cron이 매일 자동 호출. |
| **3** | **(선택) NEXT_PUBLIC_SITE_URL** | Vercel 환경 변수에 `https://본인도메인.com` 추가하면 sitemap/robots에 반영되어 검색 노출에 유리. |
| **4** | **(선택) 로고** | `public/logo.png` 등 넣고 헤더에 로고 이미지로 표시. |
| **5** | **(선택) TMDB 자동 수집** | TMDB API로 신작 메타데이터 가져와서 works에 자동 등록하는 스크립트/API 추가. |

**요약:** **1번(sync-works)** 으로 한국 OTT 인기작을 자동 수집하고, **2번(import-works)** 으로 필요할 때 엑셀/리스트 작품을 추가해 두면, **매일 유튜브 영상(sync-videos)** 은 Vercel Cron으로 자동 수집됩니다.

---

### 1) 작품 자동 수집 (sync-works) — 기본값

**한국에서 볼 수 있는 넷플릭스·디즈니+ 인기순**으로 TMDB에서 영화·드라마를 가져와 **works**에 넣습니다.

- **호출 방법 (수동 1회)**  
  - URL: `GET https://본인도메인.com/api/cron/sync-works`  
  - Header: `X-Cron-Secret: (CRON_SECRET 값)` 또는 `Authorization: Bearer (CRON_SECRET 값)`  
  - 영화 30편 + TV 30편이 works에 추가/갱신됩니다.
- **필수:** Vercel(또는 .env.local)에 **TMDB_API_KEY**가 들어 있어야 합니다.
- **자동 실행:** Vercel Cron에 포함되어 있어, **매주 목요일 새벽 4시(KST)** 에 한 번 실행됩니다. (`vercel.json`에서 스케줄 변경 가능)

### 2) 수동 리스트(엑셀)로 작품 추가 (import-works)

필요할 때 **작품명 리스트**를 보내서 기존 1번 데이터 **위에 추가**만 하는 API입니다. 엑셀에서 작품명만 복사해 JSON으로 보내면 됩니다.

- **호출 방법**  
  - URL: `POST https://본인도메인.com/api/cron/import-works`  
  - Header: `Content-Type: application/json`, `X-Cron-Secret: (CRON_SECRET 값)`  
  - Body 예시: `{ "titles": [ "대홍수", "오징어 게임 2", "듄" ] }`  
  - TMDB 검색 후 첫 번째 결과를 works에 추가합니다. 이미 있는 작품(tmdb_id 동일)은 건너뜁니다.
- **응답:** `{ "added": 2, "skipped": 1, "total": 3, "errors": [] }`  
  - 검색 실패·중복은 `errors` 또는 `skipped`로 확인 가능.

---

### 불러온 작품에 유튜브 영상 가져오기 (sync-videos)

works에 들어간 작품들(기묘한 이야기, 오징어게임 등)에 대해 **예고편·쇼츠·리뷰** 영상을 YouTube에서 가져오려면:

- **수동 1회 호출 (지금 하기)**  
  - URL: `GET https://ottsak.com/api/cron/sync-videos`  
  - Header: **X-Cron-Secret** = (Vercel에 넣은 CRON_SECRET 값)  
  - Postman 등으로 호출하면 **최근 30일 이내 등록된 works** 기준으로 YouTube 검색 후 `videos` 테이블에 저장됩니다.
- **자동:** Vercel Cron이 **매일 새벽 3시(KST)** 에 위 주소를 호출하므로, 그 이후엔 새로 넣은 작품도 자동으로 영상이 붙습니다.
